# 📸 截屏和文字选择功能说明

## ✨ 功能概述

Electron 应用版本现在支持快捷键截屏和文字选择功能，类似于插件版本的体验。

## 🎯 快捷键

### macOS
- **截屏**: `Command + Shift + K`
- **发送选中文字**: `Command + Shift + Y`
- **显示/隐藏侧边栏**: `Option + Space`

### Windows/Linux
- **截屏**: `Ctrl + Shift + K`
- **发送选中文字**: `Ctrl + Shift + Y`
- **显示/隐藏侧边栏**: `Alt + Space`

## 📖 使用方法

### 截屏功能

1. **按下截屏快捷键** (`Cmd+Shift+K` 或 `Ctrl+Shift+K`)
2. **自动操作**：
   - 捕获当前屏幕画面
   - 将截图复制到系统剪贴板
   - 自动聚焦到 AI 输入框
   - 显示提示通知
3. **粘贴截图**：在 AI 输入框中按 `Cmd+V` (Mac) 或 `Ctrl+V` (Windows) 粘贴截图
4. **发送给 AI**：添加你的问题，然后发送

### 文字选择功能

1. **选中文字**：在任何应用中选中文字
2. **复制文字**：按 `Cmd+C` (Mac) 或 `Ctrl+C` (Windows)
3. **发送到 AI**：按 `Cmd+Shift+Y` (Mac) 或 `Ctrl+Shift+Y` (Windows)
4. **自动操作**：
   - 读取剪贴板中的文字
   - 自动打开侧边栏（如果隐藏）
   - 自动将文字插入到 AI 输入框
   - 显示成功通知

## 🔧 技术实现

### 截屏功能
- 使用 Electron 的 `desktopCapturer` API 捕获屏幕
- 自动将截图写入系统剪贴板
- 通过 `executeJavaScript` 在 BrowserView 中聚焦输入框
- 用户手动粘贴（`Cmd/Ctrl+V`）到 AI 输入框

### 文字选择功能
- 从系统剪贴板读取文字（`clipboard.readText()`）
- 通过 `executeJavaScript` 在 BrowserView 中查找输入框
- 自动将文字插入到输入框
- 支持 textarea 和 contenteditable 两种输入框类型

### 架构流程

```
用户操作
  ↓
全局快捷键触发 (electron-main.js)
  ↓
captureScreen() / getSelectedText()
  ↓
发送消息到渲染进程 (mainWindow.webContents)
  ↓
electron-adapter.js 接收并显示通知
  ↓
executeJavaScript 注入到 BrowserView
  ↓
查找输入框 → 聚焦/插入文字
  ↓
完成 ✅
```

## 🎨 用户体验

### 截屏
- ⚡ **快速**：一键截图，立即复制到剪贴板
- 🎯 **自动聚焦**：输入框自动获得焦点
- 💬 **友好提示**：Toast 通知告知操作状态
- 📋 **系统集成**：截图在剪贴板中，可在任何应用使用

### 文字选择
- ⚡ **即时**：文字自动插入到输入框
- 🎯 **智能查找**：自动识别 AI 网站的输入框
- 💬 **预览提示**：显示插入文字的前 50 个字符
- 📝 **保留格式**：支持多行文字

## 🔍 兼容性

### 支持的 AI 提供商

| AI 提供商 | 截图粘贴 | 文字插入 | 备注 |
|----------|---------|---------|------|
| ChatGPT  | ✅ | ✅ | 完美支持 |
| Claude   | ✅ | ✅ | 完美支持 |
| Gemini   | ✅ | ✅ | 完美支持 |
| DeepSeek | ✅ | ✅ | 支持 |
| Grok     | ✅ | ✅ | 支持 |
| Perplexity | ⚠️ | ✅ | 不支持图片 |
| 通义千问 | ✅ | ✅ | 支持 |
| 豆包     | ✅ | ✅ | 支持 |

## 📝 注意事项

1. **截屏权限**：
   - macOS: 首次使用需要授予屏幕录制权限
   - Windows: 无需额外权限

2. **剪贴板访问**：
   - 应用需要访问系统剪贴板来读取文字和写入截图
   - 这是标准的系统 API，安全可靠

3. **文字选择**：
   - 必须先复制文字（`Cmd/Ctrl+C`）才能使用快捷键发送
   - 这是由于 Electron 应用无法直接读取其他应用的选区

4. **BrowserView 限制**：
   - BrowserView 是独立进程，无法直接访问其 DOM
   - 使用 `executeJavaScript` 注入脚本来操作输入框
   - 某些网站可能有安全策略限制脚本注入

## 🚀 改进建议

当前实现已经可以正常工作，未来可以考虑：

- [ ] 支持截取选区（而非全屏）
- [ ] 支持截图编辑（标注、箭头等）
- [ ] 支持截图历史记录
- [ ] 改进文字选择（通过辅助功能 API 直接读取选区）
- [ ] 支持同时插入多张图片
- [ ] 添加截图快捷键自定义设置

## 🐛 故障排除

### 截屏不工作
1. 检查是否授予了屏幕录制权限（macOS）
2. 查看控制台日志确认是否有错误
3. 尝试重启应用

### 文字无法插入
1. 确认已先复制文字（`Cmd/Ctrl+C`）
2. 检查 AI 网站是否已完全加载
3. 手动点击输入框，然后再试

### 快捷键冲突
- 快捷键与其他应用冲突时，可能无法触发
- 未来版本可能支持自定义快捷键

---

**享受新功能！** 🎉

如有问题，请查看控制台日志或提交 Issue。

