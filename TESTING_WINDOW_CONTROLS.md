# 窗口控制功能测试指南

## 测试环境

- macOS
- Electron 应用

## 测试前准备

1. 确保已安装依赖：
```bash
cd "/Users/apple/全局 ai 侧边栏/AI-Sidebar"
npm install
```

2. 启动应用：
```bash
npm start
```

或者使用开发模式（带开发者工具）：
```bash
npm start -- --dev
```

## 测试项目

### 1. 窗口拖动功能测试

#### 测试步骤：
1. 启动应用（按 `Alt+Space` 或 `Option+Space` 呼出侧边栏）
2. 将鼠标移动到窗口顶部区域（顶部40px）
3. 鼠标光标应该变成移动图标（十字箭头）
4. 按住鼠标左键并拖动窗口
5. 尝试将窗口拖动到屏幕的不同位置：
   - 左上角
   - 右下角
   - 屏幕中央
   - 屏幕右侧（原来的默认位置）

#### 预期结果：
- ✅ 鼠标在顶部区域时显示移动光标
- ✅ 窗口能够跟随鼠标移动
- ✅ 窗口可以停留在任意位置
- ✅ 不再强制锁定在屏幕右侧
- ✅ 拖动流畅，没有卡顿

### 2. 置顶按钮显示测试

#### 测试步骤：
1. 启动应用
2. 查看窗口右上角
3. 确认存在一个圆形的🔝按钮

#### 预期结果：
- ✅ 按钮显示在右上角，距离边缘8px
- ✅ 按钮为圆形，直径40px
- ✅ 按钮显示🔝图标
- ✅ 按钮有紫色渐变背景
- ✅ 按钮清晰可见，不被其他元素遮挡

### 3. 置顶功能测试

#### 测试步骤：
1. 启动应用
2. 点击右上角的🔝按钮
3. 打开其他应用（如浏览器、编辑器等）
4. 观察侧边栏是否保持在最上层
5. 再次点击🔝按钮
6. 观察侧边栏是否可以被其他窗口覆盖

#### 预期结果：
- ✅ 点击按钮后，按钮背景变为粉色渐变
- ✅ 侧边栏保持在所有窗口最上层
- ✅ 即使点击其他窗口，侧边栏仍然可见
- ✅ 再次点击按钮后，按钮恢复紫色渐变
- ✅ 侧边栏可以被其他窗口覆盖

### 4. 按钮交互效果测试

#### 测试步骤：
1. 将鼠标移到🔝按钮上（不要点击）
2. 观察按钮的变化
3. 点击按钮
4. 观察按钮的变化

#### 预期结果：
- ✅ 鼠标悬停时，按钮放大到1.1倍
- ✅ 鼠标悬停时，阴影加深
- ✅ 点击时，按钮缩小到0.95倍
- ✅ 所有动画流畅，持续时间0.2秒

### 5. 置顶状态持久化测试

#### 测试步骤：
1. 启动应用
2. 点击🔝按钮开启置顶
3. 隐藏应用（按 `Alt+Space` 或 `Option+Space`）
4. 再次呼出应用
5. 观察置顶状态是否保持

#### 预期结果：
- ✅ 隐藏再呼出后，置顶状态保持不变
- ✅ 按钮的视觉状态与实际置顶状态一致

注意：当前版本在应用重启后不会保存置顶状态，这是正常的。

### 6. 拖动区域与置顶按钮冲突测试

#### 测试步骤：
1. 启动应用
2. 尝试点击置顶按钮
3. 确认按钮可以正常点击，不会触发窗口拖动
4. 尝试在置顶按钮附近拖动窗口
5. 确认拖动功能正常

#### 预期结果：
- ✅ 置顶按钮可以正常点击
- ✅ 点击置顶按钮不会触发窗口拖动
- ✅ 在按钮附近的拖动区域仍然可以拖动窗口
- ✅ 两个功能互不干扰

### 7. 多显示器测试（如果有多个显示器）

#### 测试步骤：
1. 启动应用
2. 将窗口拖动到第二个显示器
3. 测试置顶功能是否正常
4. 将窗口拖回主显示器

#### 预期结果：
- ✅ 窗口可以在多个显示器间移动
- ✅ 置顶功能在所有显示器上都正常工作
- ✅ 不会出现窗口丢失或位置异常

### 8. 工具栏不冲突测试

#### 测试步骤：
1. 启动应用
2. 将鼠标移到窗口顶部，等待工具栏出现
3. 尝试点击工具栏中的按钮（如"Open in Tab"等）
4. 观察工具栏按钮是否正常工作

#### 预期结果：
- ✅ 工具栏正常显示
- ✅ 工具栏按钮可以点击
- ✅ 点击工具栏按钮不会触发窗口拖动
- ✅ 工具栏区域可以正常使用

## 已知问题

目前没有已知问题。如果发现问题，请记录：
- 问题描述
- 复现步骤
- 预期行为
- 实际行为
- 系统环境

## 性能测试

### CPU 使用率
- 启动应用
- 打开"活动监视器"（Activity Monitor）
- 查找应用进程
- 观察 CPU 使用率是否正常（应该很低）

### 内存使用
- 观察内存使用是否在合理范围内
- 长时间运行后观察是否有内存泄漏

## 控制台日志检查

在开发模式下（`npm start -- --dev`），检查控制台：
- 应该看到 "置顶功能已初始化" 的日志
- 点击置顶按钮时应该有 "Always on top: true/false" 的日志
- 不应该有错误日志

## 回归测试

确保新功能不影响原有功能：
- ✅ 快捷键 `Alt+Space` 仍然可以呼出/隐藏侧边栏
- ✅ 侧边栏可以正常滑入/滑出
- ✅ AI Provider 切换功能正常
- ✅ 历史记录功能正常
- ✅ 收藏功能正常
- ✅ 搜索功能正常
- ✅ 设置功能正常

## 测试完成检查清单

- [ ] 窗口可以自由拖动
- [ ] 置顶按钮显示正常
- [ ] 置顶功能工作正常
- [ ] 按钮交互效果流畅
- [ ] 置顶状态可以正确切换
- [ ] 不影响原有功能
- [ ] 没有控制台错误
- [ ] 性能表现良好

## 反馈

如果所有测试通过，功能已经可以正常使用！

如果发现问题，请查看：
- 控制台错误日志
- WINDOW_CONTROLS.md 文档
- 相关代码文件













